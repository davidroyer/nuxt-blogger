{"title":"Using Firebase Auth With Nuxt.js","subtitle":"Part 1","description":"This article is an overview of using Nuxt.js with Firebase Authentication. Learn how to check for admin access in your routes and use Vuex with Nuxt.js and Firebase to keep everything manageable.","tags":["vue","nuxt","firebase"],"body":"\n\nThis article is an overview of using Nuxt.js with Firebase Authentication. In Part 2, I will provide a more detail explanation of the concepts used in this example.\n\n<div class=\"flexContainer\">\n<a target=\"/\\_blank\" rel=\"noopener\" href=https://nuxt-firebase-auth.firebaseapp.com/>Live Demo</a>\n<a target=\"/\\_blank\" rel=\"noopener\" href=https://github.com/davidroyer/nuxt-firebase-auth>Github Repo</a>\n</div>\n\n**_Notes:_**\n\n* I am using SPA mode with Nuxt.js which is implemented by setting the option `mode: 'spa'` in `nuxt.config.js`.\n* You need to enable the Sign-In Method for Google from the Authentication settings via your Firebase Console.\n* I am using Firebase Hosting but it should work with any static hosting provider. However, you'll need to authorize that domain via your Firebase Console in Authentication settings via your Firebase Console under the Sign-In Methods Tab.\n\nI have created 3 files that handle the issues faced when attempting to use Firebase Auth with Nuxt.js.\n\n* `fireinit.js`\n* `fireauth.js`\n* `router-auth.js`\n\n---\n\n## Firebase App Setup\n\nTo setup/initialize the firebase app with credentials, I created `services/fireinit.js`. An issue commonly seen by developers is Firebase telling us an app already exist. The line below solves this issue.\n\n`!firebase.apps.length ? firebase.initializeApp(config) : ''`\n\nThis is an `if/else` statement in shortened form. It checks if any firebase apps already exist.\n\nIf one does not exist, initialize the app, otherwise do nothing because it's already happened so we're good to go.\n\n```js\n// This is `services/fireinit.js`\n\nimport * as firebase from 'firebase/app'\nimport 'firebase/auth'\nimport 'firebase/firestore'\nimport 'firebase/database'\n\nvar config = {\n  apiKey: 'yourProjectValueHere',\n  authDomain: 'yourProjectValueHere',\n  databaseURL: 'yourProjectValueHere',\n  projectId: 'yourProjectValueHere',\n  storageBucket: 'yourProjectValueHere',\n  messagingSenderId: 'yourProjectValueHere'\n}\n\n!firebase.apps.length ? firebase.initializeApp(config) : ''\nexport const GoogleProvider = new firebase.auth.GoogleAuthProvider()\nexport const auth = firebase.auth()\nexport const DB = firebase.database()\nexport const StoreDB = firebase.firestore()\nexport default firebase\n```\n\n---\n\n## Handling User Authentication State\n\nFirebase provides `onAuthStateChanged` to handle user state. I created `fireauth.js` to setup this functionality\n\n```js\n// This is `@plugins/fireauth.js`\n\nimport { auth } from '@/services/fireinit.js'\n\nexport default context => {\n  const { store } = context\n\n  return new Promise((resolve, reject) => {\n    auth.onAuthStateChanged(user => {\n      if (user) {\n        return resolve(store.commit('setUser', user))\n      }\n      return resolve()\n    })\n  })\n}\n```\n\n---\n\n## Protecting Authenticated Routes\n\n**Scenario 1:**\nA user is already signed-in and the next route is `/login`\n\n_Redirect to `/admin`_\n\n**Scenario 2:**\nThere is not a user signed-in and the next route is `/admin` or a sub-route such as, `/admin/settings`\n\n_Redirect to `/login`_\n\nThis functions checks for the 2 scenarios:\n\n```js\n// This is `@middleware/router-auth.js`\n\nexport default function({ store, redirect, route }) {\n  store.state.user != null && route.name == 'login' ? redirect('/admin') : ''\n  store.state.user == null && isAdminRoute(route) ? redirect('/login') : ''\n}\n\nfunction isAdminRoute(route) {\n  if (route.matched.some(record => record.path == '/admin')) {\n    return true\n  }\n}\n```\n\nWe will tell Nuxt.js to use this file by declaring it in `nuxt.config.js` as follows:\n\n```js\nrouter: {\n  middleware: 'router-auth'\n}\n```\n\nWith all of this in place, we are able to use Firebase Authentication with Nuxt.js to protect the `/admin` route as well as child routes such as `/admin/settings`.\n","id":"example-1","html":"<p>This article is an overview of using Nuxt.js with Firebase Authentication. In Part 2, I will provide a more detail explanation of the concepts used in this example.</p>\n<div class=\"flexContainer\">\n<a target=\"/\\_blank\" rel=\"noopener\" href=https://nuxt-firebase-auth.firebaseapp.com/>Live Demo</a>\n<a target=\"/\\_blank\" rel=\"noopener\" href=https://github.com/davidroyer/nuxt-firebase-auth>Github Repo</a>\n</div>\n<p><strong><em>Notes:</em></strong></p>\n<ul>\n<li>I am using SPA mode with Nuxt.js which is implemented by setting the option <code>mode: 'spa'</code> in <code>nuxt.config.js</code>.</li>\n<li>You need to enable the Sign-In Method for Google from the Authentication settings via your Firebase Console.</li>\n<li>I am using Firebase Hosting but it should work with any static hosting provider. However, you'll need to authorize that domain via your Firebase Console in Authentication settings via your Firebase Console under the Sign-In Methods Tab.</li>\n</ul>\n<p>I have created 3 files that handle the issues faced when attempting to use Firebase Auth with Nuxt.js.</p>\n<ul>\n<li><code>fireinit.js</code></li>\n<li><code>fireauth.js</code></li>\n<li><code>router-auth.js</code></li>\n</ul>\n<hr>\n<h2>Firebase App Setup</h2>\n<p>To setup/initialize the firebase app with credentials, I created <code>services/fireinit.js</code>. An issue commonly seen by developers is Firebase telling us an app already exist. The line below solves this issue.</p>\n<p><code>!firebase.apps.length ? firebase.initializeApp(config) : ''</code></p>\n<p>This is an <code>if/else</code> statement in shortened form. It checks if any firebase apps already exist.</p>\n<p>If one does not exist, initialize the app, otherwise do nothing because it's already happened so we're good to go.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// This is `services/fireinit.js`</span>\n\n<span class=\"hljs-keyword\">import</span> * <span class=\"hljs-keyword\">as</span> firebase <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'firebase/app'</span>\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">'firebase/auth'</span>\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">'firebase/firestore'</span>\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">'firebase/database'</span>\n\n<span class=\"hljs-keyword\">var</span> config = {\n  <span class=\"hljs-attr\">apiKey</span>: <span class=\"hljs-string\">'yourProjectValueHere'</span>,\n  <span class=\"hljs-attr\">authDomain</span>: <span class=\"hljs-string\">'yourProjectValueHere'</span>,\n  <span class=\"hljs-attr\">databaseURL</span>: <span class=\"hljs-string\">'yourProjectValueHere'</span>,\n  <span class=\"hljs-attr\">projectId</span>: <span class=\"hljs-string\">'yourProjectValueHere'</span>,\n  <span class=\"hljs-attr\">storageBucket</span>: <span class=\"hljs-string\">'yourProjectValueHere'</span>,\n  <span class=\"hljs-attr\">messagingSenderId</span>: <span class=\"hljs-string\">'yourProjectValueHere'</span>\n}\n\n!firebase.apps.length ? firebase.initializeApp(config) : <span class=\"hljs-string\">''</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> GoogleProvider = <span class=\"hljs-keyword\">new</span> firebase.auth.GoogleAuthProvider()\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> auth = firebase.auth()\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> DB = firebase.database()\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> StoreDB = firebase.firestore()\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> firebase\n</code></pre>\n<hr>\n<h2>Handling User Authentication State</h2>\n<p>Firebase provides <code>onAuthStateChanged</code> to handle user state. I created <code>fireauth.js</code> to setup this functionality</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// This is `@plugins/fireauth.js`</span>\n\n<span class=\"hljs-keyword\">import</span> { auth } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'@/services/fireinit.js'</span>\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> context =&gt; {\n  <span class=\"hljs-keyword\">const</span> { store } = context\n\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =&gt;</span> {\n    auth.onAuthStateChanged(<span class=\"hljs-function\"><span class=\"hljs-params\">user</span> =&gt;</span> {\n      <span class=\"hljs-keyword\">if</span> (user) {\n        <span class=\"hljs-keyword\">return</span> resolve(store.commit(<span class=\"hljs-string\">'setUser'</span>, user))\n      }\n      <span class=\"hljs-keyword\">return</span> resolve()\n    })\n  })\n}\n</code></pre>\n<hr>\n<h2>Protecting Authenticated Routes</h2>\n<p><strong>Scenario 1:</strong>\nA user is already signed-in and the next route is <code>/login</code></p>\n<p><em>Redirect to <code>/admin</code></em></p>\n<p><strong>Scenario 2:</strong>\nThere is not a user signed-in and the next route is <code>/admin</code> or a sub-route such as, <code>/admin/settings</code></p>\n<p><em>Redirect to <code>/login</code></em></p>\n<p>This functions checks for the 2 scenarios:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// This is `@middleware/router-auth.js`</span>\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">{ store, redirect, route }</span>) </span>{\n  store.state.user != <span class=\"hljs-literal\">null</span> &amp;&amp; route.name == <span class=\"hljs-string\">'login'</span> ? redirect(<span class=\"hljs-string\">'/admin'</span>) : <span class=\"hljs-string\">''</span>\n  store.state.user == <span class=\"hljs-literal\">null</span> &amp;&amp; isAdminRoute(route) ? redirect(<span class=\"hljs-string\">'/login'</span>) : <span class=\"hljs-string\">''</span>\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">isAdminRoute</span>(<span class=\"hljs-params\">route</span>) </span>{\n  <span class=\"hljs-keyword\">if</span> (route.matched.some(<span class=\"hljs-function\"><span class=\"hljs-params\">record</span> =&gt;</span> record.path == <span class=\"hljs-string\">'/admin'</span>)) {\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span>\n  }\n}\n</code></pre>\n<p>We will tell Nuxt.js to use this file by declaring it in <code>nuxt.config.js</code> as follows:</p>\n<pre><code class=\"hljs language-js\">router: {\n  <span class=\"hljs-attr\">middleware</span>: <span class=\"hljs-string\">'router-auth'</span>\n}\n</code></pre>\n<p>With all of this in place, we are able to use Firebase Authentication with Nuxt.js to protect the <code>/admin</code> route as well as child routes such as <code>/admin/settings</code>.</p>\n"}
